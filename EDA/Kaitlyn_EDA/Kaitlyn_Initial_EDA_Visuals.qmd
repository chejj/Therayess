---
title: "Kaitlyn Initial Metadata EDA cMD3 for CRC Progression"
format: html
editor: visual
grid:
      body-width: 1500px
---

### Library Load & Setup

```{r}
#| label: Setup
# ---
  
suppressPackageStartupMessages({
  library(ggplot2)
  library(dplyr)
  library(knitr)
  library(patchwork)
})

progression_order <- c(
  "Other", 
  "HC",
  "PA",
  "PA+",
  "PA-M",
  "CRC",
  "CRC+",
  "CRC-H",
  "CRC-M"
)

progression_colors <- c(
  "HC" = "#539deb",
  "PA" = "#e4e85b",
  "PA+" = "#e8a25b",
  "CRC" = "#cf1919",
  "CRC+" = "#8f0000",
  "CRC-M" = "#4d0404",
  "CRC-H" = "#520f76",
  "Other" = "#aaa3a3"
)

qualifying_studies <- qualifying_studies %>% 
  mutate(
    disease_class = factor(disease_class, levels = progression_order)
  )
```

# Ideas of Interest:

1.  Diet

2.  BMI

3.  Gender analysis

4.  Smoking & Drinking

## Contributing Studies

```{r}
#| label: Study Counts & Proportions Check
# ---
  
# Bar Chart
###########
contributor1 <- qualifying_studies %>%
  # Plotting
  # --------
  ggplot(aes(x = reorder(study_name, study_name, 
                         FUN = function(x) -length(x)),
                         fill = disease_class)) +
  geom_bar() +
  scale_fill_manual(values = progression_colors, 
                    name = "CRC Progression \nCategory") +
  theme(axis.text.x = element_text(angle = 20, hjust = 1, lineheight = 1.1)) +
  # Labeling
  #---------
  xlab("Author Last Name, First Initial, and Year") +
  ylab("Sample Count") +
  ggtitle("Qualifying Study Sample Count by CRC Progression Category")

# Bar Chart by Study
####################
contributor2 <- qualifying_studies %>%
  # Plotting
  # --------
  ggplot(aes(x = reorder(study_name, study_name, 
                         FUN = function(x) -length(x)),
                         fill = disease_class)) +
  geom_bar(position = "fill") +
  scale_fill_manual(values = progression_colors, 
                    name = "CRC Progression \nCategory") +
  theme(axis.text.x = element_text(angle = 20, hjust = 1, lineheight = 1.1)) +
  # Labeling
  #---------
  xlab("Author Last Name, First Initial, and Year") +
  ylab("Disease Category Proportion") +
  ggtitle("Qualifying Study Sample Proportions by CRC Progression Category")

contributor1

contributor2
```

### Disease Count Check

```{r}
#| label: Study Disease Proportion Check
# ---
  
# Bar Chart of total CRC Progression Category Proportions
#########################################################
qualifying_studies %>%
  # Plotting
  # --------
  ggplot(aes(x=disease_class, stat = "count", fill = disease_class)) +
  geom_bar() +
  scale_fill_manual(values = progression_colors, 
                    name = "CRC Progression \nCategory") +
  # Labeling
  #---------
  labs(y = "Sample Count", x = "CRC Progression") +
  ggtitle("Counts of CRC Progression Stages in Study")
```

## Age Analysis

### Normality

```{r}
#| label: Normality Check Age Plain
# ---
# QQPlot
########
normality1 <- qualifying_studies %>% 
  # Set Up
  # ------
  filter(!is.na(age)) %>%
  # Plotting
  # --------
  ggplot(aes(sample = age)) + 
  geom_qq() + 
  geom_qq_line() +
  # Labeling
  #---------
  ggtitle("QQ Plot of Age")

# Histogram
###########
normality2 <- qualifying_studies %>%
  # Set Up
  # ------
  filter(!is.na(age)) %>%
  # Plotting
  # --------
  ggplot(aes(x = age)) + 
  geom_histogram(bins=20) + 
  # Labeling
  #---------
  ggtitle("Distribution of age") +
  xlab("age")

normality1 / normality2

# Gendered Histogram
####################
qualifying_studies %>%
  # Set Up
  # ------
  filter(!is.na(age), !is.na(gender)) %>%
  # Plotting
  # --------
  ggplot(aes(x = age)) + 
  geom_histogram(bins = 30, fill = "#539deb", color = "black") +
  facet_wrap(~gender) +
  # Labeling
  #---------
  ggtitle("Distribution of Age") +
  labs(x = "Age", y = "Count")
```

### By Decade

```{r}
#| label: Age by Decade

# Barplot of Age by Decade
##########################
decade1 <- qualifying_studies %>% 
  # Set Up 
  # ------ 
  filter (!is.na(age_decade)) %>% 
  # Plotting 
  # -------- 
  ggplot(aes(x=age_decade)) + 
  geom_bar() + 
  
  # Labeling 
  #--------- 
  geom_text(stat = "count", aes(label = after_stat(count)), 
            vjust = -0.21, size = 3.5, color = "black") +
  theme(axis.text.x = element_text(angle = 30, hjust = 1, lineheight = 1.1), 
        axis.title.x = element_text(hjust = 1.5), 
        plot.title = element_text(hjust = -0.5)) +
  xlab("Age by Decade") + 
  labs(
    title = "Age Distribution By Decade", 
    subtitle = "With and Without CRC Progression")

# Barplot of age categories: Colored
####################################
decade2 <- qualifying_studies %>% 
  # Set Up 
  # ------ 
  filter (!is.na(age_decade)) %>% 
  # Plotting 
  # -------- 
  ggplot(aes(x=age_decade, fill = disease_class)) + 
  geom_bar() + 
  scale_fill_manual(values = progression_colors, 
                    name = "CRC Progression \nCategory") + 
  # Labeling 
  #--------- 
  theme(axis.text.x = element_text(angle = 30, hjust = 1, lineheight = 1.1),
    axis.title.y = element_blank(),
    axis.title.x = element_blank(),
    axis.text.y = element_blank()
  )

# Age by Decade Patchwork
#########################
decade1 + decade2

# Proportion: Age Decade
###########################
decade3 <- qualifying_studies %>%
  # Set Up
  # ------
  filter (!is.na(age_decade)) %>%
  # Plotting
  # --------
  ggplot(aes(x=age_decade, fill = disease_class)) +
  geom_bar(position="fill") +
  scale_fill_manual(values = progression_colors, name = "CRC Progression \nCategory") +
  # Labeling
  #---------
  ggtitle("Proportion of CRC Progression by Age Decade") + 
  labs(x = "Age By Decade", y = "Proportion")

decade3



```

### By Gender

```{r}
#| label: Gendered Disease Comparisons
# ---

# Gender By Disease Category
############################
qualifying_studies %>% 
  # Set-up
  # ------
  filter(!is.na(age), !is.na(gender)) %>% 
  # Plotting
  # --------
  ggplot(aes(x=gender, fill=disease_class)) +
  geom_bar(position = "fill") +
  scale_fill_manual(values = progression_colors, 
                    name = "CRC Progression \nCategory") +
  # Labeling
  #---------
  ggtitle("Proportions of CRC Progression Categorization by Gender") +
  labs(x = "Age", y = "Proportion") +
  theme(axis.text.x = element_text(angle = 25, hjust = 1, lineheight = 1.1))

# Gendered Barplot: Counts
##########################
qualifying_studies %>%
  # Set Up
  # ------
  filter(!is.na(age), !is.na(gender)) %>%
  # Plotting
  # --------
  ggplot(aes(x = age_decade, fill = disease_class)) + 
  geom_bar() +
  scale_fill_manual(values = progression_colors, 
                    name = "CRC Progression \nCategory") +
  facet_wrap(~gender) +
  # Labeling
  #---------
  ggtitle("Distribution of Age") +
  labs(x = "Age", y = "Count") +
  theme(axis.text.x = element_text(angle = 25, hjust = 1, lineheight = 1.1))

# Gendered Barplot: Proportions
###############################
qualifying_studies %>%
  # Set Up
  # ------
  filter(!is.na(age), !is.na(gender)) %>%
  # Plotting
  # --------
  ggplot(aes(x = age_decade, fill = disease_class)) + 
  geom_bar(position = "fill") +
  scale_fill_manual(values = progression_colors, 
                    name = "CRC Progression \nCategory") +
  facet_wrap(~gender) +
  # Labeling
  #---------
  ggtitle("Distribution of Age") +
  labs(x = "Age", y = "Proportion") +
  theme(axis.text.x = element_text(angle = 25, hjust = 1, lineheight = 1.1))
```

#### Disease Category Box Plots

```{r}
#| label: Box Plots Age 
# ---  
# Our categories 
################ 
qualifying_studies %>%   
  # Set Up   
  # ------   
  filter(!is.na(age)) %>%   
  # Plotting   
  # --------   
  ggplot(aes(x=disease_class, y=age)) +    
  geom_boxplot(outlier.shape = NA) +   
  geom_jitter(alpha = 0.15, width = 0.15) +   
  stat_summary(fun = mean, geom = "point", shape = 20, size = 5, color = "red") +
  # Labeling   
  #---------   
  ggtitle("Distribution of Age by CRC Progression") +   
  ylab("Age") +    xlab("CRC Progression")  

# Disease Location 
################# 
qualifying_studies %>%   
  # Set Up   
  # ------   
  filter (!is.na(age), !is.na(disease_location)) %>%   
  # Plotting   
  # --------   
  ggplot(aes(x=disease_location, y=age)) +    
  geom_boxplot(outlier.shape = NA, ) +   
  geom_jitter(alpha = 0.15, width = 0.15) +   
  stat_summary(fun = mean, geom = "point", shape = 20, size = 5, color = "red") +     # Labeling   
  #---------   
  ggtitle("Distribution of Age by Disease Location") +   
  theme(axis.text.x = element_text(size = 8, angle = 15)) +   
  ylab("Age") +    
  xlab("Disease Location")  

# Disease Stage 
############### 
qualifying_studies %>%   
  # Set Up   
  # ------   
  filter (!is.na(age), !is.na(disease_stage)) %>%   
  # Plotting   
  # --------   
  ggplot(aes(x=disease_stage, y=age)) +    
  geom_boxplot(outlier.shape = NA) +   
  geom_jitter(alpha = 0.15, width = 0.15) +   
  stat_summary(fun = mean, geom = "point", shape = 20, size = 5, color = "red") +     # Labeling   
  #---------   
  ggtitle("Distribution of Age by Disease Stage") +   
  ylab("Age") +    
  xlab("Disease Stage") 
```

## Geography & Ethnicity

Note: We actually have no information on the ethnicity of our study subjects in the filtered data set, so we would need to assume that their ethnicity matches the majority of the country they are documented from (Japan, USA, etc.). While not perfect, it is likely that they active location/geography influences their microbiome more.

### Country

```{r}
#| label: Countries Disease Comparisons
# ---

# Countries sample count distribution
#####################################

country1 <- qualifying_studies  %>% 
  # Set Up
  # ------
  filter(!is.na(country)) %>%
  # Plotting
  # --------
  ggplot(aes(x = reorder(country, country, 
                         FUN = function(x) -length(x)))) + 
  geom_bar() +
  # Labeling
  #---------
  geom_text(stat = "count", aes(label = after_stat(count)), 
            vjust = -0.21, size = 3, color = "black") +
  theme(axis.text.x = element_text(angle = 30, hjust = 0.9, lineheight = 1.1), 
        axis.title.x = element_text(hjust = -0.75), 
        plot.title = element_text(hjust = -0.6), 
        plot.subtitle = element_text(hjust = -0.5)) +
  xlab("Country (NATO country code, trigram)") + 
  labs(
    title = "Country Sample Count Distribution", 
    subtitle = "With and Without CRC Disease Progression")

country2 <- qualifying_studies  %>% 
  # Set Up
  # ------
  filter(!is.na(country)) %>%
  # Plotting
  # --------
  ggplot(aes(x = reorder(country, country, 
                         FUN = function(x) -length(x)), 
             fill=disease_class)) + 
  geom_bar() +
  scale_fill_manual(values = progression_colors, 
                    name = "CRC Progression \nCategory") +
  # Labeling
  #---------
  theme(axis.text.x = element_text(angle = 30, hjust = 0.9, lineheight = 1.1),
    axis.title.y = element_blank(),
    axis.title.x = element_blank(),
    axis.text.y = element_blank()
  )

country1 | country2

# Countries Barplot: Proportions
################################
qualifying_studies %>% 
  # Set Up
  # ------
  filter(!is.na(country)) %>%
  # Plotting
  # --------
  ggplot(aes(x = reorder(country, country, 
                         FUN = function(x) -length(x)), fill = disease_class)) + 
  geom_bar(position = "fill") +
  scale_fill_manual(values = progression_colors, 
                    name = "CRC Progression \nCategory") +
  # Labeling
  #---------
  ggtitle("Proportion of CRC Progression Per Country") +
  labs(x = "Country (NATO country code, trigram)", y = "Proportion")
```

### City

```{r}
#| label: Location (City) Disease Comparisons
# ---

# Location (City) sample count distribution
#####################################

city1 <- qualifying_studies  %>% 
  # Set Up
  # ------
  filter(!is.na(location)) %>%
  # Plotting
  # --------
  ggplot(aes(x = reorder(location, location, 
                         FUN = function(x) -length(x)))) + 
  geom_bar() +
  # Labeling
  #---------
  geom_text(stat = "count", aes(label = after_stat(count)), 
            vjust = -0.21, size = 3, color = "black") +
  theme(axis.text.x = element_text(angle = 30, hjust = 0.9, lineheight = 1.1), 
        axis.title.x = element_text(hjust = 1.5), 
        plot.title = element_text(hjust = -0.5), 
        plot.subtitle = element_text(hjust = -1)) +
  xlab("Location (City)") + 
  labs(
    title = "Location (City) Sample Count Distribution", 
    subtitle = "With and Without CRC Progression")

city2 <- qualifying_studies  %>% 
  # Set Up
  # ------
  filter(!is.na(location)) %>%
  # Plotting
  # --------
  ggplot(aes(x = reorder(location, location, 
                         FUN = function(x) -length(x)), 
             fill=disease_class)) + 
  geom_bar() +
  scale_fill_manual(values = progression_colors, 
                    name = "CRC Progression \nCategory") +
  # Labeling
  #---------
  theme(axis.text.x = element_text(angle = 30, hjust = 0.9, lineheight = 1.1),
    axis.title.y = element_blank(),
    axis.title.x = element_blank(),
    axis.text.y = element_blank()
  )

city1 | city2

# Countries Barplot: Proportions
################################
qualifying_studies  %>% 
  # Set Up
  # ------
  filter(!is.na(location)) %>%
  # Plotting
  # --------
  ggplot(aes(x = reorder(location, location, 
                         FUN = function(x) -length(x)), fill = disease_class)) + 
  geom_bar(position = "fill") +
  scale_fill_manual(values = progression_colors, 
                    name = "CRC Progression \nCategory") +
  # Labeling
  #---------
  ggtitle("Proportion of CRC Progression Per Location (City)") +
  labs(x = "Location (City)", y = "Proportion")

```

## Diet

```{r}
#| label: Diet and CRC
# --- 

# Diet Barplot: Counts
qualifying_studies %>%
  # Set Up
  # ------
  filter(!is.na(diet)) %>%
  # Plotting
  # --------
  ggplot(aes(x = reorder(diet, diet, 
                         FUN = function(x) -length(x)))) + 
  geom_bar(aes(fill = disease_class)) +
  scale_fill_manual(values = progression_colors, name = "CRC Progression") +
  # Labeling
  #---------
  geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.17, color = "black") +
  ggtitle("Diet of Indiviudals") +
  labs(x = "Diet", y = "Counts")

# Diet Barplot: Proportion
qualifying_studies %>%
  # Set Up
  # ------
  filter(!is.na(diet)) %>%
  # Plotting
  # --------
  ggplot(aes(x = reorder(diet, diet, 
                         FUN = function(x) -length(x)))) + 
  geom_bar(aes(fill = disease_class), position = "fill") +
  scale_fill_manual(values = progression_colors, name = "CRC Progression") +
  # Labeling
  #---------
  ggtitle("Diet of Indiviudals") +
  labs(x = "Diet", y = "Proportion")
```

## BMI

```{r}

```

## Smoking & Alcohol

```{r}

```
